<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel=preload as=font href=https://kubedl.io/fonts/vendor/jost/jost-v4-latin-regular.woff2 type=font/woff2 crossorigin><link rel=preload as=font href=https://kubedl.io/fonts/vendor/jost/jost-v4-latin-700.woff2 type=font/woff2 crossorigin><link rel=stylesheet href=https://kubedl.io/main.98c6810c151bb3db1afbf300c2e9af82a22890d62454377a26e46294650e276c5371dfc2439b9f49a5b8a0cc701fc39e3085acb28fcf644afbf9e283707dff9d.css integrity="sha512-mMaBDBUbs9sa+/MAwumvgqIokNYkVDd6JuRilGUOJ2xTcd/CQ5ufSaW4oMxwH8OeMIWsso/PZEr7+eKDcH3/nQ==" crossorigin=anonymous><noscript><style>img.lazyload{display:none}</style></noscript><meta name=robots content="index, follow"><meta name=googlebot content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1"><meta name=bingbot content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1"><title>Metadata Persistency - KubeDL</title><meta name=description content="KubeDL is a unififed operator helping you run multiple kinds of deep learning training workloads on Kubernetes."><link rel=canonical href=https://kubedl.io/docs/recipes/metadata-persistency/><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://kubedl.io/kubedlicon.png"><meta name=twitter:title content="Metadata Persistency"><meta name=twitter:description content="Kubernetes api-server typically stores job information for a limited lifespan. KubeDL has built-in support to persist the job metadata into external storage to outlive api-server state. The KubeDL controller will persist the job metadata during the lifecycle of job such as job and pod creation/deletion.
Currently, only Mysql is supported.
DB Schema Job Table    Column Type Description     id int(64) primary id auto incremented by underlying database   name varchar(128) name of job   namespace varchar(128) namespace of job   job_id varchar(64) job uid generated by kubernetes   version varchar(32) resource version generated by kubernetes(etcd)   status varchar(32) current observed job status(Created/Running/Failed/Succeed/Restarting)   kind varchar(32) kind of job: TFJob,PyTorchJob&mldr;   resources text job requested resources, including replicas and resources of each role."><meta name=twitter:site content="@"><meta name=twitter:creator content="@"><meta property="og:title" content="Metadata Persistency"><meta property="og:description" content="Kubernetes api-server typically stores job information for a limited lifespan. KubeDL has built-in support to persist the job metadata into external storage to outlive api-server state. The KubeDL controller will persist the job metadata during the lifecycle of job such as job and pod creation/deletion.
Currently, only Mysql is supported.
DB Schema Job Table    Column Type Description     id int(64) primary id auto incremented by underlying database   name varchar(128) name of job   namespace varchar(128) namespace of job   job_id varchar(64) job uid generated by kubernetes   version varchar(32) resource version generated by kubernetes(etcd)   status varchar(32) current observed job status(Created/Running/Failed/Succeed/Restarting)   kind varchar(32) kind of job: TFJob,PyTorchJob&mldr;   resources text job requested resources, including replicas and resources of each role."><meta property="og:type" content="article"><meta property="og:url" content="https://kubedl.io/docs/recipes/metadata-persistency/"><meta property="og:image" content="https://kubedl.io/kubedlicon.png"><meta property="article:published_time" content="2021-04-08T14:47:51-07:00"><meta property="article:modified_time" content="2021-04-08T14:47:51-07:00"><meta property="og:site_name" content="KubeDL"><meta property="article:publisher" content="https://www.facebook.com/"><meta property="article:author" content="https://www.facebook.com/"><meta property="og:locale" content="en_US"><script type=application/ld+json>{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Home","item":"https:\/\/kubedl.io"},{"@type":"ListItem","position":3,"name":"Docs","item":"https:\/\/kubedl.io\/docs\/"},{"@type":"ListItem","position":4,"name":"Recipes","item":"https:\/\/kubedl.io\/docs\/recipes\/"},{"@type":"ListItem","position":5,"name":"Metadata Persistency","item":"https:\/\/kubedl.io\/docs\/recipes\/metadata-persistency\/"}]}</script><meta name=theme-color content="#fff"><link rel=apple-touch-icon sizes=180x180 href=https://kubedl.io/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=https://kubedl.io/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=https://kubedl.io/favicon-16x16.png><link rel=manifest href=https://kubedl.io/site.webmanifest></head><body class="docs single"><div class="header-bar fixed-top"></div><header class="navbar fixed-top navbar-expand-md navbar-light"><div class=container><input class="menu-btn order-0" type=checkbox id=menu-btn>
<label class="menu-icon d-md-none" for=menu-btn><span class=navicon></span></label><a class="navbar-brand order-1 order-md-0 me-auto" href=https://kubedl.io>KubeDL</a>
<button id=mode class="btn btn-link order-2 order-md-4" type=button aria-label="Toggle mode">
<span class=toggle-dark><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-moon"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg></span><span class=toggle-light><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-sun"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></span></button><ul class="navbar-nav social-nav order-3 order-md-5"><li class=nav-item><a class=nav-link href=https://github.com/alibaba/kubedl><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg><span class="ms-2 visually-hidden">GitHub</span></a></li></ul><div class="collapse navbar-collapse order-4 order-md-1"><ul class="navbar-nav main-nav me-auto order-5 order-md-2"><li class=nav-item><a class=nav-link href=https://kubedl.io/docs/prologue/introduction/>Training</a></li><li class=nav-item><a class=nav-link href=https://kubedl.io/model/intro>Model</a></li><li class=nav-item><a class=nav-link href=https://kubedl.io/serving/intro>Serving</a></li><li class=nav-item><a class=nav-link href=https://kubedl.io/tuning/intro>Morphling</a></li><li class=nav-item><a class=nav-link href=https://kubedl.io/docs/contributing/how-to-contribute>Contribute</a></li></ul><div class="break order-6 d-md-none"></div><form class="navbar-form flex-grow-1 order-7 order-md-3"><input id=userinput class="form-control is-search" type=search placeholder="Search docs..." aria-label="Search docs..." autocomplete=off><div id=suggestions class="shadow bg-white rounded"></div></form></div></div></header><div class="wrap container" role=document><div class=content><div class="row flex-xl-nowrap"><div class="col-lg-5 col-xl-4 docs-sidebar"><nav class=docs-links aria-label="Main navigation"><h3>Introduction</h3><ul class=list-unstyled><li><a class=docs-link href=https://kubedl.io/docs/prologue/introduction/>Introduction</a></li><li><a class=docs-link href=https://kubedl.io/docs/prologue/install-using-helm/>Install Using Helm</a></li><li><a class=docs-link href=https://kubedl.io/docs/prologue/install-using-yaml/>Install Using Yaml</a></li><li><a class=docs-link href=https://kubedl.io/docs/prologue/quick-start/>Quick Start</a></li><li><a class=docs-link href=https://kubedl.io/docs/prologue/commands/>Commands</a></li></ul><h3>Tutorial</h3><ul class=list-unstyled><li><a class=docs-link href=https://kubedl.io/docs/tutorial/tutorial/>Tutorial</a></li></ul><h3>Workloads</h3><ul class=list-unstyled><li><a class=docs-link href=https://kubedl.io/docs/workloads/pytorch/>PyTorch</a></li><li><a class=docs-link href=https://kubedl.io/docs/workloads/tensorflow/>TensorFlow</a></li><li><a class=docs-link href=https://kubedl.io/docs/workloads/mars/>Mars</a></li><li><a class=docs-link href=https://kubedl.io/docs/workloads/xgboost/>XGBoost</a></li><li><a class=docs-link href=https://kubedl.io/docs/workloads/mpi/>Mpi</a></li><li><a class=docs-link href=https://kubedl.io/docs/workloads/cron/>Cron Training</a></li></ul><h3>features</h3><ul class=list-unstyled><li><a class=docs-link href=https://kubedl.io/docs/recipes/code-sync/>File Sync</a></li><li><a class=docs-link href=https://kubedl.io/docs/recipes/hostnetwork/>Host Network</a></li><li><a class=docs-link href=https://kubedl.io/docs/recipes/tensorboard/>Tensorboard</a></li><li><a class="docs-link active" href=https://kubedl.io/docs/recipes/metadata-persistency/>Metadata Persistency</a></li><li><a class=docs-link href=https://kubedl.io/docs/recipes/events-persistency/>Events Persistency</a></li><li><a class=docs-link href=https://kubedl.io/docs/recipes/dashboard/>Dashboard</a></li><li><a class=docs-link href=https://kubedl.io/docs/recipes/scheduling/>Gang Scheduling</a></li></ul><h3>References</h3><ul class=list-unstyled><li><a class=docs-link href=https://kubedl.io/docs/references/metrics/>Metrics</a></li><li><a class=docs-link href=https://kubedl.io/docs/references/dockerhub/>Docker Images</a></li><li><a class=docs-link href=https://kubedl.io/docs/references/flags/>Startup flags</a></li><li><a class=docs-link href=https://kubedl.io/docs/references/crd/>Training CRD Spec</a></li></ul><h3>contributing</h3><ul class=list-unstyled><li><a class=docs-link href=https://kubedl.io/docs/contributing/how-to-contribute/>How to Contribute</a></li><li><a class=docs-link href=https://kubedl.io/docs/contributing/code-of-conduct/>Code of Conduct</a></li><li><a class=docs-link href=https://kubedl.io/docs/contributing/comparisons/>Comparisons</a></li></ul><h3>Help</h3><ul class=list-unstyled><li><a class=docs-link href=https://kubedl.io/docs/help/dingtalk/>Dingtalk</a></li><li><a class=docs-link href=https://kubedl.io/docs/help/troubleshooting/>Troubleshooting</a></li></ul></nav></div><nav class="docs-toc d-none d-xl-block col-xl-3" aria-label="Secondary navigation"><div class=page-links><h3>On this page</h3><nav id=TableOfContents><ul><li><a href=#db-schema>DB Schema</a><ul><li><a href=#job-table>Job Table</a></li><li><a href=#pod-table>Pod Table</a></li></ul></li><li><a href=#how-to-use>How To Use</a></li><li><a href=#mysql-config>MySql Config</a></li><li><a href=#contributions>Contributions</a></li></ul></nav></div></nav><main class="docs-content col-lg-11 col-xl-9"><nav aria-label=breadcrumb><ol class=breadcrumb><li class=breadcrumb-item><a href=https://kubedl.io/>Home</a></li><li class=breadcrumb-item><a href=https://kubedl.io/docs/>Docs</a></li><li class=breadcrumb-item><a href=https://kubedl.io/docs/recipes/>Recipes</a></li><li class="breadcrumb-item active" aria-current=page>Metadata Persistency</li></ol></nav><h1>Metadata Persistency</h1><p class=lead></p><p>Kubernetes api-server typically stores job information for a limited lifespan. KubeDL has built-in support to persist the
job metadata into external storage to outlive api-server state.
The KubeDL controller will persist the job metadata during the lifecycle of job such as job and pod creation/deletion.</p><p>Currently, only <code>Mysql</code> is supported.</p><h2 id=db-schema>DB Schema<a href=#db-schema class=anchor aria-hidden=true>#</a></h2><h3 id=job-table>Job Table<a href=#job-table class=anchor aria-hidden=true>#</a></h3><table><thead><tr><th><strong>Column</strong></th><th><strong>Type</strong></th><th><strong>Description</strong></th></tr></thead><tbody><tr><td>id</td><td>int(64)</td><td>primary id auto incremented by underlying database</td></tr><tr><td>name</td><td>varchar(128)</td><td>name of job</td></tr><tr><td>namespace</td><td>varchar(128)</td><td>namespace of job</td></tr><tr><td>job_id</td><td>varchar(64)</td><td>job uid generated by kubernetes</td></tr><tr><td>version</td><td>varchar(32)</td><td>resource version generated by kubernetes(etcd)</td></tr><tr><td>status</td><td>varchar(32)</td><td>current observed job status(Created/Running/Failed/Succeed/Restarting)</td></tr><tr><td>kind</td><td>varchar(32)</td><td>kind of job: TFJob,PyTorchJob&mldr;</td></tr><tr><td>resources</td><td>text</td><td>job requested resources, including replicas and resources of each role.</td></tr><tr><td>deploy_region</td><td>varchar(64)</td><td>deploy_region indicates the physical region(IDC) this job located in, reserved for jobs running in across-region-clusters</td></tr><tr><td>tenant</td><td>varchar(255)</td><td>fields reserved for multi-tenancy job management scenarios, indicating which tenant this job belongs to and who&rsquo;s the owner(user)</td></tr><tr><td>owner</td><td>varchar(255)</td><td>owner of job</td></tr><tr><td>is_in_etcd</td><td>tinyint(4)</td><td>is_in_etcd indicates that whether record of this job has been removed from etcd</td></tr><tr><td>gmt_created</td><td>datetime</td><td>timestamp when job created</td></tr><tr><td>gmt_modified</td><td>datetime</td><td>timestamp when last job status transited</td></tr><tr><td>gmt_finished</td><td>datetime</td><td>timestamp when job failed or succeed</td></tr></tbody></table><h3 id=pod-table>Pod Table<a href=#pod-table class=anchor aria-hidden=true>#</a></h3><table><thead><tr><th><strong>Column</strong></th><th><strong>Type</strong></th><th><strong>Description</strong></th></tr></thead><tbody><tr><td>id</td><td>int(64)</td><td>primary id auto incremented by underlying database</td></tr><tr><td>name</td><td>varchar(128)</td><td>name of pod</td></tr><tr><td>namespace</td><td>varchar(128)</td><td>namespace of pod</td></tr><tr><td>pod_id</td><td>varchar(64)</td><td>pod uid generated by kubernetes</td></tr><tr><td>version</td><td>varchar(32)</td><td>resource version generated by kubernetes(etcd)</td></tr><tr><td>status</td><td>varchar(32)</td><td>current observed pod phase(Pending/Running/Failed/Succeed/Unkown)</td></tr><tr><td>image</td><td>varchar(255)</td><td>image name of main conatiner</td></tr><tr><td>job_id</td><td>varchar(64)</td><td>job id of this pod controlled by</td></tr><tr><td>replica_type</td><td>varchar(32)</td><td>replica type of this pod belongs to</td></tr><tr><td>resources</td><td>varchar(1024)</td><td>resources this pod requested, marshaled from a ResourceRequirements object</td></tr><tr><td>host_ip</td><td>varchar(64)</td><td>ip of the host this pod scheduled</td></tr><tr><td>pod_ip</td><td>varchar(64)</td><td>ip of this pod allocated</td></tr><tr><td>deploy_region</td><td>varchar(64)</td><td>deploy_region indicates the physical region(IDC) this job located in</td></tr><tr><td>is_in_etcd</td><td>tinyint(4)</td><td>is_in_etcd indicates that whether record of this job has been removed from etcd</td></tr><tr><td>remark</td><td>text</td><td>extended messaged for pod</td></tr><tr><td>gmt_created</td><td>datetime</td><td>timestamp when pod created</td></tr><tr><td>gmt_modified</td><td>datetime</td><td>timestamp when last pod status transited</td></tr><tr><td>gmt_started</td><td>datetime</td><td>timestamp when main container stared</td></tr><tr><td>gmt_finished</td><td>datetime</td><td>timestamp when pod failed or succeed</td></tr></tbody></table><h2 id=how-to-use>How To Use<a href=#how-to-use class=anchor aria-hidden=true>#</a></h2><p>Below is an example to setup KubeDL to use <code>Mysql</code> as the persistency DB.</p><ol><li>Set up credentials for KubeDL to connect to DB. Create a <code>Secret</code> object like below:</li></ol><pre><code class=language-yaml>apiVersion: v1
kind: Secret
metadata:
  name: kubedl-mysql-config
  namespace: kubedl-system
type: Opaque
stringData:
  host: my.host.com
  dbName: kubedl
  user: kubedl-user
  password: this-is-me
  port: &quot;3306&quot;
</code></pre><ol start=2><li>Update the Kubedl Deployment spec to include <code>--meta-storage mysql</code> in the startup flag and reference the DB credentials
via environment variables. The KubeDL controller uses the env to set up connection with DB.</li></ol><pre><code class=language-yaml>apiVersion: apps/v1
kind: Deployment
metadata:
  name: kubedl
  namespace: kubedl-system
  labels:
    app: kubedl
spec:
  replicas: 1
  selector:
    matchLabels:
      app: kubedl
  template:
    metadata:
      labels:
        app: kubedl
    spec:
      containers:
      - image: kubedl/kubedl:v0.3.0
        imagePullPolicy: Always
        name: kubedl-manager
        args:
        - &quot;--meta-storage&quot;
        - &quot;mysql&quot;
        env:
        - name: MYSQL_HOST
          value:
          valueFrom:
            secretKeyRef:
              name: kubedl-mysql-config
              key: host
        - name: MYSQL_DB_NAME
          value:
          valueFrom:
            secretKeyRef:
              name: kubedl-mysql-config
              key: dbName
        - name: MYSQL_USER
          value:
          valueFrom:
            secretKeyRef:
              name: kubedl-mysql-config
              key: user
        - name: MYSQL_PASSWORD
          value:
          valueFrom:
            secretKeyRef:
              name: kubedl-mysql-config
              key: password
</code></pre><h2 id=mysql-config>MySql Config<a href=#mysql-config class=anchor aria-hidden=true>#</a></h2><p>The configs defined in the aforementioned <code>secret</code>:</p><table><thead><tr><th>Config Name</th><th>Description</th></tr></thead><tbody><tr><td>host</td><td>Mysql host name</td></tr><tr><td>dbName</td><td>DB name</td></tr><tr><td>user</td><td>User name</td></tr><tr><td>password</td><td>User password</td></tr><tr><td>port</td><td>The mysql DB port to connect to</td></tr></tbody></table><h2 id=contributions>Contributions<a href=#contributions class=anchor aria-hidden=true>#</a></h2><p>Currently, only <code>mysql</code> is supported. You are welcome to contribute your own storage plugin.</p><p class=edit-page><a href=https://github.com/jian-he/website/blob/master/content/docs/recipes/metadata-persistency.md><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-edit-2"><path d="M17 3a2.828 2.828.0 114 4L7.5 20.5 2 22l1.5-5.5L17 3z"/></svg>Edit this page on GitHub</a></p><div class="docs-navigation d-flex justify-content-between"><a href=https://kubedl.io/docs/prologue/quick-start/><div class="card my-1"><div class="card-body py-2">&larr; Quick Start</div></div></a><a class=ms-auto href=https://kubedl.io/docs/workloads/xgboost/><div class="card my-1"><div class="card-body py-2">XGBoost &rarr;</div></div></a></div></main></div></div></div><footer class="footer text-muted"><div class=container><div class=row><div class="col-lg-8 order-last order-lg-first"><ul class=list-inline><li class=list-inline-item></li></ul></div><div class="col-lg-8 order-first order-lg-last text-lg-end"><ul class=list-inline></ul></div><div class="col-lg-8 order-first order-lg-last text-lg-end"></div></div></div><div class=container><div class=row><div align=center><b>KUBEDL IS A CLOUD NATIVE COMPUTING FOUNDATION PROJECT</b></div><div align=center><img src=https://camo.githubusercontent.com/8aee669db45b82619559ea89a92cfa656ef700a1eddb3aa4eefb140ec9187551/68747470733a2f2f7636642e696f2f5f7374617469632f636e63662d636f6c6f722e737667 width=500 title></div><div align=center style="width:800px;margin:0 auto" ;><p>The Linux Foundation has registered trademarks and uses trademarks. For a list of trademarks of The Linux Foundation, please see our <a href=https://www.linuxfoundation.org/trademark-usage/>Trademark Usage page.</a></p></div></div></div></footer><script src=https://kubedl.io/js/bootstrap.min.147781275026c7f79c240496685b0f80683b48064e41b7c5471c3d8e497b98e99666a1db84761c5582c8af6c679e41ff486a4a0c0dfcba83abf7784797e20b96.js integrity="sha512-FHeBJ1Amx/ecJASWaFsPgGg7SAZOQbfFRxw9jkl7mOmWZqHbhHYcVYLIr2xnnkH/SGpKDA38uoOr93hHl+ILlg==" crossorigin=anonymous defer></script><script src=https://kubedl.io/main.min.a299a1a7bfe24933d3e8b3daf793904a82cc9ed621b88314216ba53e5a9bdde72905e163e7d8c199a8ec959e7d8de0bdee97404be7b4e610447597e023142bb0.js integrity="sha512-opmhp7/iSTPT6LPa95OQSoLMntYhuIMUIWulPlqb3ecpBeFj59jBmajslZ59jeC97pdAS+e05hBEdZfgIxQrsA==" crossorigin=anonymous defer></script><script src=https://kubedl.io/js/highlight.min.a6a7fccf09ced05e7561f7b80470bea4cdd069dca59af6fbb3f3fa739283aa7f68475de54066137c4e7f6f2727c5f37fca0258081be293bd612d01e24fe5fcc1.js defer></script><script src=https://kubedl.io/index.min.bd85e62dbbd6b8f0fb80e0f7df40ea6002d5c240c9ebfc32678cf42bcd23c234a1048afa60884a69a88cad6676220828cd62a7c4b759264301d09285eacd5c60.js integrity="sha512-vYXmLbvWuPD7gOD330DqYALVwkDJ6/wyZ4z0K80jwjShBIr6YIhKaaiMrWZ2IggozWKnxLdZJkMB0JKF6s1cYA==" crossorigin=anonymous defer></script></body></html>